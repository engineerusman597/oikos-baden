@using Infrastructure.Security
@using Oikos.Web.States
@using Oikos.Application.Services.Authentication
@using Oikos.Common.Resources


<div class="d-flex flex-column pa-2 gap-4" style="width:100%;height:100%;overflow:auto">
    <MudPaper Outlined="true" Class="pa-4">
        <MudStack Row="true" Spacing="3" AlignItems="AlignItems.Center">
            <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                <MudFileUpload Class="flex-none" T="IBrowserFile" FilesChanged="UploadFiles" Accept=".png, .jpg">
                    <ActivatorContent>
                        <MudIconButton Color="Color.Primary" Variant="Variant.Filled" Size="Size.Large">
                            @if (string.IsNullOrEmpty(_user.Avatar))
                            {
                                <MudAvatar Color="Color.Primary" Size="Size.Large">
                                    @(_user.RealName?.FirstOrDefault() ?? _user.Name?.FirstOrDefault())
                                </MudAvatar>
                            }
                            else
                            {
                                <MudAvatar Size="Size.Large">
                                    <MudImage Src="@("Avatars/" + _user.Avatar)"></MudImage>
                                </MudAvatar>
                            }
                        </MudIconButton>
                    </ActivatorContent>
                </MudFileUpload>
                <MudText Typo="Typo.subtitle1">@_user.RealName</MudText>
            </MudStack>
        </MudStack>
    </MudPaper>

    <MudGrid GutterSpacing="3">
        <MudItem xs="12" md="7">
            <MudPaper Outlined="true" Class="pa-4 h-100">
                <MudText Typo="Typo.subtitle1" Class="mb-2">@Loc["AccountSettings_Info"]</MudText>
                <MudList T="string" Dense="true" DisablePadding="true">
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_Username"]</MudText>
                        <MudSpacer />
                        <MudText>@(_user.Name ?? Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_FullName"]</MudText>
                        <MudSpacer />
                        <MudText>@(_user.RealName ?? Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_AcademicTitle"]</MudText>
                        <MudSpacer />
                        <MudText>@(!string.IsNullOrWhiteSpace(_user.AcademicTitle) ? _user.AcademicTitle : Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_Gender"]</MudText>
                        <MudSpacer />
                        <MudText>@(!string.IsNullOrWhiteSpace(_user.Gender) ? _user.Gender : Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_Company"]</MudText>
                        <MudSpacer />
                        <MudText>@(!string.IsNullOrWhiteSpace(_user.Company) ? _user.Company : Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_Email"]</MudText>
                        <MudSpacer />
                        <MudText>@(_user.Email ?? Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_Phone"]</MudText>
                        <MudSpacer />
                        <MudText>@(_user.PhoneNumber ?? Loc["AccountSettings_NotProvided"])</MudText>
                    </MudListItem>
                    <MudDivider />
                    <MudListItem>
                        <MudText Color="Color.Secondary">@Loc["AccountSettings_CustomerNumber"]</MudText>
                        <MudSpacer />
                        <MudText>@(_user.CustomerNumber ?? Loc["AccountSettings_NotAssigned"])</MudText>
                    </MudListItem>
                </MudList>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="5">
            <MudStack Spacing="2">
                <MudPaper Outlined="true" Class="pa-4">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.subtitle1">@Loc["AccountSettings_Security"]</MudText>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Lock" OnClick="ChangePwd">@Loc["AccountSettings_ChangePassword"]</MudButton>
                    </MudStack>
                </MudPaper>

                @if (_hasActiveSubscription)
                {
                    <MudPaper Outlined="true" Class="pa-4">
                        <MudStack Spacing="1">
                            <MudText Typo="Typo.subtitle1">@Loc["AccountSettings_ActivePlan"]</MudText>
                            <MudText><b>@Loc["AccountSettings_PlanLabel"]</b> @_activePlanName</MudText>
                            <MudText><b>@Loc["AccountSettings_ExpiresLabel"]</b> @_planExpirationText</MudText>
                        </MudStack>
                    </MudPaper>
                }
            </MudStack>
        </MudItem>
    </MudGrid>
</div>
