@using Oikos.Application.Services.Partner.Models
<MudDialog MaxWidth="MaxWidth.Medium" FullWidth="true">
    <DialogContent>
        <MudForm @ref="_form">
            <MudText Typo="Typo.h5" Class="mb-2">@(_isEdit ? Loc["InsuranceEditor_EditTitle"] : Loc["InsuranceEditor_CreateTitle"])</MudText>
            <MudTextField T="string" Label="@Loc["InsuranceEditor_NameLabel"]" @bind-Value="Partner.Name" Required="true" For="() => Partner.Name" />
            <MudTextField T="string" Label="@Loc["InsuranceEditor_DescriptionLabel"]" @bind-Value="Partner.Description" Lines="3" Class="mt-3" />
            <MudTextField T="string" Label="@Loc["InsuranceEditor_CoverageLabel"]" @bind-Value="Partner.CoverageDetails" Lines="4" Class="mt-3" />
            <MudTextField T="string" Label="@Loc["InsuranceEditor_ContactLabel"]" @bind-Value="Partner.ContactInfo" Lines="2" Class="mt-3" />
            <MudTextField T="string" Label="@Loc["InsuranceEditor_WebsiteLabel"]" @bind-Value="Partner.WebsiteUrl" Class="mt-3" />
            <MudTextField T="string" Label="@Loc["InsuranceEditor_LogoLabel"]" @bind-Value="Partner.LogoUrl" Class="mt-3" />
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="Cancel">@Loc["Common_Cancel"]</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveAsync">@Loc["Common_Save"]</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter] public InsurancePartner Partner { get; set; } = new();

    private MudForm? _form;
    private bool _isEdit;

    protected override void OnInitialized()
    {
        _isEdit = Partner.Id != Guid.Empty;
        if (Partner.Id == Guid.Empty)
        {
            Partner.Id = Guid.NewGuid();
        }
    }

    private async Task SaveAsync()
    {
        if (_form is not null)
        {
            await _form.Validate();
            if (!_form.IsValid)
            {
                return;
            }
        }

        MudDialog.Close(DialogResult.Ok(Partner));
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }
}
