@page "/reset-password/{Token}"
@rendermode InteractiveServer
@attribute [AllowAnonymous]
@using Microsoft.AspNetCore.Components.Forms

<MudContainer MaxWidth="MaxWidth.Small" Class="forgot-password-container">
    <MudPaper Class="pa-6" Elevation="2">
        <MudStack Spacing="3">
            <MudText Typo="Typo.h5">@Loc["ResetPassword_Title"]</MudText>
            <MudText Typo="Typo.body2" Class="mud-text-secondary">@Loc["ResetPassword_Subtitle"]</MudText>

            @if (_isProcessing)
            {
                <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Class="py-8">
                    <MudProgressCircular Indeterminate="true" Size="Size.Large" />
                </MudStack>
            }
            else if (_resetCompleted)
            {
                <MudAlert Severity="Severity.Success" Dense="true">
                    @Loc["ResetPassword_Success"]
                </MudAlert>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4" Href="/login">
                    @Loc["ForgotPassword_BackToLogin"]
                </MudButton>
            }
            else if (_tokenInvalid)
            {
                <MudAlert Severity="Severity.Error" Dense="true">
                    @Loc["ResetPassword_InvalidToken"]
                </MudAlert>
                <MudButton Variant="Variant.Text" Color="Color.Primary" Class="mt-4" Href="/forgot-password">
                    @Loc["ResetPassword_RequestNew"]
                </MudButton>
            }
            else
            {
                <EditForm EditContext="_editContext" OnSubmit="SubmitAsync">
                    <DataAnnotationsValidator />
                    <MudTextField @bind-Value="_model.Password" Label="@Loc["ResetPassword_NewPasswordLabel"]" Variant="Variant.Outlined"
                                  For="@(() => _model.Password)" InputType="InputType.Password" Immediate="true"></MudTextField>
                    <ValidationMessage For="@(() => _model.Password)" />
                    <MudTextField @bind-Value="_model.ConfirmPassword" Label="@Loc["ResetPassword_ConfirmPasswordLabel"]" Variant="Variant.Outlined"
                                  For="@(() => _model.ConfirmPassword)" InputType="InputType.Password" Immediate="true"></MudTextField>
                    <ValidationMessage For="@(() => _model.ConfirmPassword)" />

                    <MudStack Row="true" Justify="Justify.FlexEnd" Class="mt-4">
                        <MudButton Color="Color.Primary" Variant="Variant.Filled" ButtonType="ButtonType.Submit" Disabled="_isSubmitting">
                            @if (_isSubmitting)
                            {
                                <MudProgressCircular Indeterminate="true" Size="Size.Small" Class="mr-2" />
                            }
                            @Loc["ResetPassword_Submit"]
                        </MudButton>
                    </MudStack>
                </EditForm>
            }
        </MudStack>
    </MudPaper>
</MudContainer>

<style>
    .forgot-password-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
    }
</style>
