@page "/user-bonix/company-checks/history"

@using Oikos.Application.Services.CompanyCheck.Models
@using Oikos.Web.Components.Layout.PageLayout

@rendermode RenderMode.InteractiveServer

<PageLayout>
    <ChildContent>
        <MudStack Spacing="4">
            @* Header Section *@
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudStack Spacing="0">
                    <MudText Typo="Typo.h5" Style="font-weight: 700;">@Loc["HistoryPageTitle"]</MudText>
                    <MudText Typo="Typo.body2" Class="mud-text-secondary">@Loc["HistoryPageSubtitle"]</MudText>
                </MudStack>
                <MudButton Variant="Variant.Filled" 
                           Color="Color.Primary" 
                           StartIcon="@Icons.Material.Filled.Add" 
                           Href="/user-bonix/company-checks">
                    @Loc["HistoryEmptyStateButton"]
                </MudButton>
            </MudStack>

            @* Table *@
            <MudPaper Class="company-checks-history-table" Elevation="0" Outlined="true">
                @if (_isLoading)
                {
                    <MudStack AlignItems="AlignItems.Center" Class="pa-8">
                        <MudProgressCircular Indeterminate="true" />
                    </MudStack>
                }
                else if (!_items.Any())
                {
                    <MudStack AlignItems="AlignItems.Center" Class="pa-8" Spacing="2">
                        <MudIcon Icon="@Icons.Material.Outlined.Description" Size="Size.Large" Color="Color.Default" Style="font-size: 64px; opacity: 0.5;" />
                        <MudText Typo="Typo.h6" Class="mud-text-secondary">@Loc["HistoryEmptyStateDescription"]</MudText>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-2" Href="/user-bonix/company-checks">@Loc["HistoryEmptyStateButton"]</MudButton>
                    </MudStack>
                }
                else
                {
                    <MudTable T="CompanyCheckHistoryItem"
                              Items="@_items"
                              Hover="true"
                              Dense="true"
                              Breakpoint="Breakpoint.Sm"
                              Elevation="0">
                        <HeaderContent>
                            <MudTh>@Loc["HistoryTableCompany"]</MudTh>
                            <MudTh>@Loc["HistoryTableCountry"]</MudTh>
                            <MudTh>@Loc["HistoryTablePaidAt"]</MudTh>
                            <MudTh Class="text-right">@Loc["HistoryTableActions"]</MudTh>
                        </HeaderContent>
                        <RowTemplate Context="item">
                            <MudTd DataLabel="@Loc["HistoryTableCompany"]">
                                <MudText Typo="Typo.body2" Class="font-weight-medium">@item.CompanyName</MudText>
                            </MudTd>
                            <MudTd DataLabel="@Loc["HistoryTableCountry"]">@item.CountryCode</MudTd>
                            <MudTd DataLabel="@Loc["HistoryTablePaidAt"]">@FormatPaidAt(item.PaidAt)</MudTd>
                            <MudTd Class="text-right" DataLabel="@Loc["HistoryTableActions"]">
                                <div style="display: inline-flex; gap: 4px; justify-content: flex-end;">
                                    <MudTooltip Text="@Loc["HistoryDetailsButton"]" Color="Color.Primary">
                                        <MudIconButton Icon="@Icons.Material.Outlined.Visibility"
                                                       Color="Color.Primary"
                                                       Size="Size.Small"
                                                       OnClick="@(() => ShowDetailsAsync(item))" />
                                    </MudTooltip>
                                    @if (!string.IsNullOrWhiteSpace(item.DownloadUrl))
                                    {
                                        <MudTooltip Text="@Loc["HistoryDownloadButton"]" Color="Color.Primary">
                                            <MudIconButton Icon="@Icons.Material.Filled.Download"
                                                           Color="Color.Primary"
                                                           Size="Size.Small"
                                                           Href="@item.DownloadUrl"
                                                           Target="_blank" />
                                        </MudTooltip>
                                    }
                                </div>
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                }
            </MudPaper>
        </MudStack>
    </ChildContent>
</PageLayout>
